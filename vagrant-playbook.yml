#!/usr/bin/env ansible-playbook
---

- name: Provision RHEL8 VM
  hosts: all:!localhost
  become: true
  gather_facts: true

  roles:
    - dvd_repository

- name: Provision AAP
  hosts: server01,server02
  become: true
  gather_facts: true

  tasks:
    - name: Configure time
      ansible.builtin.include_role:
        name: chrony
    - name: Setup ssh keys for install
      ansible.builtin.include_role:
        name: ssh_keys
    - name: Relax settings for install
      ansible.builtin.include_role:
        name: grace_period
        tasks_from: present
    - name: Install Automation Platform
      ansible.builtin.include_role:
        name: aap
    - name: Enforce compliance settings
      ansible.builtin.include_role:
        name: grace_period
        tasks_from: absent
    - name: Improve compliance settings
      ansible.builtin.include_role:
        name: rhel8_fixes
